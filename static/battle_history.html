<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Battle History</title>
    <link rel="stylesheet" href="static/styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <h1>전투 기록</h1>
    <div id="battleHistory"></div>
    <button onclick="goBack()">돌아가기</button>

    <script>
      async function fetchBattleHistory() {
        try {
          const response = await fetch("/get-battle-history");
          const history = await response.json();

          const battleHistoryDiv = document.getElementById("battleHistory");
          battleHistoryDiv.innerHTML = "";

          if (history.length === 0) {
            battleHistoryDiv.innerHTML = "<p>전투 기록이 없습니다.</p>";
            return;
          }

          // 최신 기록이 위로 오도록 배열을 역순으로 반복합니다.
          history
            .slice()
            .reverse()
            .forEach((record) => {
              const recordDiv = document.createElement("div");
              recordDiv.innerHTML = `
              <p>시간: ${record.timestamp}</p>
              <p>상태: ${record.status}</p>
              <p>메시지: ${record.message}</p>
              <h3>플레이어</h3>
              <p>이름: ${record.player.name}</p>
              <p>HP: ${record.player.hp}</p>
              <p>공격력: ${record.player.attack}</p>
              <p>방어력: ${record.player.defense}</p>
              <p>레벨: ${record.player.level}</p>
              <p>경험치: ${record.player.exp}</p>
              <h3>몬스터</h3>
              <p>이름: ${record.monster.name}</p>
              <p>HP: ${record.monster.hp}</p>
              <p>공격력: ${record.monster.attack}</p>
              <p>방어력: ${record.monster.defense}</p>
              <h3>전투 로그</h3>
              <p>${record.log.join("<br/>")}</p>
              <hr/>
            `;
              battleHistoryDiv.appendChild(recordDiv);
            });
        } catch (error) {
          console.error("전투 기록을 가져오는 중 오류가 발생했습니다:", error);
        }
      }

      function goBack() {
        window.location.href = "/";
      }

      // 페이지 로드 시 전투 기록을 가져옵니다.
      fetchBattleHistory();
    </script>
  </body>
</html>
